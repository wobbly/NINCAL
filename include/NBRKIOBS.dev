..............................................................................
.
. NBRKIO INCLUSION
. NIN BROKER FILE I/O ROUTINES
. practice file, named NBRKIOBS.dev
.
. REVISED 03AUG93 ADDED SALES PERSIN
.
. FILE NAME : NINBRK
. REC LENGTH: 151 FIXED
. INDEX KEY : 1-4,5-7 (4 POSITION BRK#, 3 POSITION CONTACT#)
.
..............................................................................
.
. ENTRY POINT : NBRKKEY
. REQUIRED    : 'NBRKFLD'
. RETURNED    : BROKER RECORD
. DESCRIPTION : EXACT ISAM KEY READ
.               APPLICATION'S RESPONSIBILITY TO TEST FLAGS
.
NBRKKEY  BRANCH    NBRKFLAG TO NBRK1
         CALL      NBRKOPEN
..ADDED         
NBRK1B   BRANCH    NBRKLOCK TO NBRK1BL,NBRK1BR,NBRK1BN
NBRK1BL  FILEPI    1;NBKRFILE  
         READ      NBRKFILE,NBRKFLD;NBRKVARS      1-4    BROKER NUMBER. **KEY**
         RETURN
NBKR1BR  READLK    NBRKFILE,NBRKFLD;NBRKVARS
         RETURN
NBKR1BN  READ      NBRKFILE,NBRKFLD;NBRKVARS
         RETURN
..END ADD
..............................................................................
.
. ENTRY POINT : NBRKTST
. REQUIRED    : NBRKFLD
. RETURNED    :
. DESCRIPTION : TEST KEY
.
NBRKTST  BRANCH    NBRKFLAG TO NBRK2
         CALL      NBRKOPEN
NBRK2    FILEPI    1;NBRKFILE
         READ      NBRKFILE,NBRKFLD;STR1
         RETURN
..............................................................................
.
. ENTRY POINT : NBRKKS
. REQUIRED    :
. RETURNED    : BROKER RECORD
. DESCRIPTION : KEY SEQUENTIAL BROKER FILE READ
.
NBRKKS   BRANCH    NBRKFLAG TO NBRK3
         CALL      NBRKOPEN
..ADDED
NBRK3B   BRANCH    NBRKLOCK TO NBRK3BL,NBRK3BR,NBRK3BN

NBRK3BL  FILEPI    1;NBKRFILE    
         READKS    NBRKFILE;NBRKVARS      1-3    BROKER NUMBER. **KEY**
         RETURN
NBKR3BR  READLK    NBRKFILE;NBRKVARS
         RETURN
NBKR3BN  READ      NBRKFILE;NBRKVARS
         RETURN
..END ADD         
..............................................................................
.
. ENTRY POINT : NBRKSEQ
. REQUIRED    :
. RETURNED    : BROKER RECORD
. DESCRIPTION : SEQUENTIAL BROKER FILE READ
.               APPLICATION'S RESPONSIBILITY TO TEST FLAGS
.
NBRKSEQ  BRANCH    NBRKPATH TO NBRK4A,NBRKGONE,NBRK4C
NBRK4A   BRANCH    NBRKFLAG TO NBRK4B
         CALL      NBRKOPEN
NBRK4B   FILEPI    1;NBRKFILE
         READ      NBRKFILE,SEQ;NBRKVARS
         RETURN
NBRK4C   BRANCH    NBRKFLG3 TO NBRK4D
         CALL      NBRKOPEN
..ADDED         
NBRK4LB  BRANCH   NBRKLOCK TO NBRK4BL,NBRK4BR,NBRK4BN
NBRK4LBL FILEPI    1;NBKRFILE  
         READ      NBRKFLE3,SEQ;NBRKVARS
         RETURN
NBKR4LBR READLK    NBRKFLE3,SEQ;NBRKVARS
         RETURN
NBKR4LBN READ      NBKRFILE
         RETURN
..END ADD
..............................................................................
.
. ENTRY POINT : NBRKWRT
. REQUIRED    : 'NBRKFLD'
. RETURNED    :
. DESCRIPTION : EXACT ISAM KEY TXT/ISI INSERT
.
NBRKWRT  MOVE      C1 TO NBRKPATH
NBRKWRT1 COMPARE   NBRKPATH TO NBRKFLAG
         GOTO      NBRK5 IF EQUAL
         CALL      NBRKOPEN
NBRK5    FILEPI    1;NBRKFILE
         WRITE     NBRKFILE,NBRKFLD;NBRKVARS                               BRKCNT:       5-7    BROKER CONTACT NUMBER. 
         CALL      NBRKWRT2
         RETURN
.......................
NBRKWRT2 BRANCH    NBRKFLG2 TO NBRK5B
         CALL      NBRKOPN2
..ADDED
NBRK5B   BRANCH    NBRKLOCK TO NBRK5BL,NBRK5BR,NBRK5BN

NBRK5BL  FILEPI    1;NBKRFLE2    
         READKS    NBRKFLE2;NBRKVARS      1-3    BROKER NUMBER. **KEY**
         RETURN
NBKR5BR  READLK    NBKRFLE2
         RETURN
NBKR5BN  READ      NBKRFLE2
         RETURN
..END ADD   
..............................................................................
.
. ENTRY POINT : NBRKUPD
. REQUIRED    : A PREVIOUS KEY READ
. RETURNED    :
. DESCRIPTION : KEY UPDATE BROKER FILE
.
NBRKUPD  BRANCH    NBRKFLAG TO NBRK6
         CALL      NBRKOPEN
NBRK6    FILEPI    1;NBRKFILE
         UPDATE    NBRKFILE;NBRKVARS
         RETURN
..............................................................................
.
. ENTRY POINT : NBRKDEL
. REQUIRED    : 'NBRKFLD'
. RETURNED    :
. DESCRIPTION : EXACT ISAM KEY TXT/ISI DELETE
.
NBRKDEL  BRANCH    NBRKFLAG TO NBRK7
         CALL      NBRKOPEN
NBRK7    FILEPI    1;NBRKFILE
         DELETE    NBRKFILE,NBRKFLD
         RETURN
...............................................................................
..............................................................................
.
. ENTRY POINT : NBRKAIM   
. REQUIRED    : BRKAKEY
. RETURNED    : BROKER RECORD
. DESCRIPTION : AIM BROKER FILE READ
.               APPLICATION'S RESPONSIBILITY TO TEST FLAGS
.
NBRKAIM  BRANCH    NBRKFLG2 TO NBRK9
         CALL      NBRKOPN2
..ADDED
NBRK9B   BRANCH    NBRKLOCK TO NBRK9BL,NBRK9BR,NBRK9BN

NBRK9BL  FILEPI    1;NBKRFLE2    
         READKS    NBRKFILE;NBRKVARS      1-3    BROKER NUMBER. **KEY**
         RETURN
NBKR9BR  READLK    NBRKFLE2,NBRKFLD2;NBRKVARS
         RETURN
NBKR9BN  READ      NBRKFLE2,NBRKFLD2;NBRKVARS
         RETURN
..END ADD   
..............................................................................
.
. ENTRY POINT : NBRKKG
. REQUIRED    : VALID PREVIOUS AIM READ
. RETURNED    : BROKER RECORD
. DESCRIPTION : AIM KEY GENEREIC BROKER FILE READ
.               APPLICATION'S RESPONSIBILITY TO TEST FLAGS
.
NBRKKG   BRANCH    NBRKFLG2 TO NBRK10
         CALL      NBRKOPN2
..ADDED
NBRK10B  BRANCH    NBRKLOCK TO NBRK10BL,NBRK10BR,NBRK10BN

NBRK10BL FILEPI    1;NBKRFLE2    
         READKS    NBRKFILE;NBRKVARS      1-3    BROKER NUMBER. **KEY**
         RETURN
NBKR10BR READLK    NBRKFLE2;NBRKVARS
         RETURN
NBKR10BN READ      NBRKFLE2;NBRKVARS
         RETURN
..END ADD 
..............................................................................
.
         IFZ      PC
. ENTRY POINT : NBRKKGP
. REQUIRED    : PREVIOUS VALID AIM READ
. RETURNED    : BROKER RECORD
. DESCRIPTION : KEY GENERIC PRIOR BROKER FILE READ
.               APPLICATION'S RESPONSIBILITY TO TEST FLAGS
.
NBRKKGP  BRANCH    NBRKFLG2 TO NBRK11
         CALL      NBRKOPN2
NBRK11   FILEPI    1;NBRKFLE2
         READKGP   NBRKFLE2;NBRKVARS
         RETURN
         XIF
..............................................................................
.
. ENTRY POINT : NBRKOPEN
. REQUIRED    : 'NBRKFLAG'
. RETURNED    : 'NBRKFLAG' SET TO '1' IF OPENNED
. DESCRIPTION : OPEN NIN BROKER FILE
.               DISPLAY ERROR AND ABORT IF NOT ON-LINE.
.
NBRKOPEN BRANCH    NBRKPATH OF NBRKOPN1,NBRKOPN2,NBRKOPN3
NBRKOPN1 TRAP      NBRKGONE IF IO
         OPEN      NBRKFILE,NBRKNAME
         TRAPCLR   IO
         MOVE      C1 TO NBRKFLAG
         RETURN
.
NBRKOPN2 TRAP      NBRKGONE IF IO
         OPEN      NBRKFLE2,NBRKNAME
         TRAPCLR   IO
         MOVE      C1 TO NBRKFLG2
         RETURN
.
NBRKOPN3 TRAP      NBRKGONE IF IO
         OPEN      NBRKFLE3,NBRKNAME
         TRAPCLR   IO
         MOVE      C1 TO NBRKFLG3
         RETURN
.
NBRKGONE MOVE      NBRKNAME TO FILENAME
         CALL      FILEGONE
.
..............................................................................

